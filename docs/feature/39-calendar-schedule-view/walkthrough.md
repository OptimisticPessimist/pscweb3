# カレンダー形式の日程調整と稽古可能シーン判定機能 - Walkthrough

本機能の実装により、日程調整の利便性が大幅に向上し、演出家や制作担当者が「いつ、どのシーンを稽古できるか」をカレンダー上で直感的に把握できるようになりました。

## 実装内容の構成

### 1. カレンダー表示機能
- FullCalendar を使用した月間ビューの実装。
- 候補日程をカレンダー上のイベントとして表示。
- 時間帯（午前・午後・夜間など）を視認しやすいバッジ表示。

### 2. シーン可否判定ロジック（バックエンド）
- 候補日程ごとに、回答済みのメンバー構成から「全ての必須キャストが揃っているシーン」を自動算出。
- **リーチ判定**: あと1人足りない場合に「不足メンバー名」を表示し、調整を促す機能。
- **役職必須設定**: 演出家・制作などの特定役職が不在の場合、自動的に「稽古不可」と判定。

### 3. 詳細サイドパネル（フロントエンド）
- カレンダーの日程をクリックすると、右側から詳細パネルがスライドイン。
- パネル内でその日の「参加可能メンバー」と「稽古可能なシーン（およびリーチシーン）」を表示。
- パネル内から直接その日程で稽古を確定（リハーサル作成）できる連携機能。

### 4. 日程調整の作成（拡張）
- 日程調整の新規作成時に、どの役職（スタッフロール）を出席必須とするかを選択できる UI を追加。
- 役職を選択することで、演出家などが不在の日程をおすすめから除外する高度な判定を実現。

## 確認手順

1. **日程調整の作成**:
   - `/projects/{projectId}/polls/new` にアクセス。
   - タイトル・説明を入力し、「出席必須の役職」から「演出」などを選択。
   - 候補日時をいくつか追加して作成。

2. **カレンダーでの確認**:
   - 作成した日程調整の詳細ページを開く。
   - 「表形式」と「カレンダー形式」をトグルボタンで切り替える。
   - カレンダー上の青い枠（候補日程）をクリック。
   - 右側のパネルに、稽古可能シーンやリーチシーンが表示されることを確認。

3. **役職必須の動作確認**:
   - 必須とした役職（例：演出）のユーザーが `×` 回答をした日程について、カレンダー上で詳細を開くと「不足役職」が表示され、シーンが「稽古不可」となっていることを確認。

## 技術的ポイント
- **計算効率**: バックエンドで香盤表とキャスティング情報を統合的に解析し、1MB 以下の軽量な JSON 形式で分析結果（Calendar Analysis）を返却するように最適化。
- **UX/UI**: サイドパネルによるスムーズな遷移と、状態に応じたカラーコード（グリーン: 稽古可能、イエロー: リーチ、グレー: 不可）により直感的な操作性を実現。
