# Code Review - Feature: Exclude Public Scripts from Limit

## 1. 概要
- **対象ファイル**: `backend/src/services/project_limit.py`, `backend/src/api/projects.py`, `backend/src/services/script_processor.py`
- **総合評価**: 5/5
- **要約**: プロジェクト制限のロジックを共通サービスとして切り出し、新規作成・インポート・更新の各ポイントで適切に呼び出しています。特に更新時の「抜け道」対策も実装されており、設計意図通りに機能しています。

## 2. 詳細レビュー
| 観点 | 評価 | コメント |
| :--- | :--- | :--- |
| 命名の適切さ | OK | `check_project_limit`, `project_id_to_exclude`, `new_project_is_public` など、引数の意図が明確です。 |
| 変数の粒度 | OK | 必要なスコープで変数が定義されています。 |
| メソッド・関数の粒度 | OK | 制限チェックロジックが1つの関数に集約されており、再利用性が高いです。 |
| 冗長性の排除 | OK | `projects.py` 内の重複コードが解消され、共通化されました。 |
| 条件式の単純さ | OK | `any(s.is_public ...)` による公開判定や、除外IDの判定はシンプルで読みやすいです。 |
| セキュリティ | OK | ユーザーIDに基づいたフィルタリングが適切に行われており、他人のプロジェクトが混入することはありません。 |
| 可読性 | OK | Docstringやコメントが記述されており、処理の流れが追いやすいです。 |

## 3. 具体的な指摘事項と修正案
特になし。

## 4. 改善提案
- 現状は「1プロジェクト1脚本」が基本となっているため `any()` で判定していますが、将来的に複数脚本に対応する場合でも「1つでも公開されていれば公開プロジェクト」という定義であれば、このロジックのままで問題ありません。
- パフォーマンスに関して、ユーザーごとのプロジェクト数は現在少ない想定（制限があるため）なので、Python側でのループ処理によるフィルタリングで問題ありません。将来的に制限が大幅に緩和される場合は、クエリレベルでの集計（`having` 句など）を検討しても良いでしょう。
