# 公開脚本プロジェクトの制限除外 Walkthrough

## 概要
ユーザーがオーナーとして作成できるプロジェクト数の制限（上限2つ）について、**「公開設定された脚本を含むプロジェクト」を制限カウントから除外**するように変更しました。
これにより、ユーザーは自分の作品を公開し続ける限り、実質的にプロジェクト数の制限を受けずに創作活動を行うことができます。

## 変更点

### バックエンド
- **新しい制限チェックロジック (`backend/src/services/project_limit.py`)**:
  - ユーザーがオーナーのプロジェクトのうち、「公開脚本が1つもないプロジェクト（＝プライベートプロジェクト）」の数をカウントします。
  - その数が2つ以上ある場合、新規作成やインポートをブロックします。

- **APIの修正**:
  - `create_project` (`backend/src/api/projects.py`): 新しいチェックロジックを使用するように変更しました。
  - `import_script` (`backend/src/api/projects.py`): インポート直後は非公開となるため、プライベートプロジェクトとしてカウントします。

- **抜け道対策 (Loophole Prevention)**:
  - スクリプトの更新時 (`backend/src/services/script_processor.py`)、公開していた脚本を「非公開」に変更しようとした際にも制限チェックを行います。
  - もし非公開にすることで制限（プライベート2つ）を超過してしまう場合は、更新を拒否しエラーメッセージを表示します。

## 検証結果
`backend/tests/unit/test_project_limit.py` による自動テストで以下を確認しました。

1. **通常ケース**: プライベートプロジェクトを2つまで作成可能。3つ目はエラー。
2. **除外ケース**: 公開脚本を含むプロジェクトはカウントされず、追加でプライベートプロジェクトを作成可能。
3. **抜け道防止**: 制限ギリギリの状態で、公開プロジェクトを非公開に変更しようとするとエラーになること。

これにより、ユーザーは「公開すること」をインセンティブとして、より多くのプロジェクトを管理できるようになります。
