# チケット予約システム実装 Walkthrough

## 概要
チケット予約システム（定員管理、紹介者機能、自動返信メール、Googleカレンダー連携、管理者向けCSVエクスポート）を実装しました。

## 変更内容

### バックエンド
- **API**: `GET /api/public/milestones/{id}`、`POST /api/public/reservations` などのエンドポイントを追加。
- **Schema**: `MilestoneResponse` に予約定員 (`reservation_capacity`) を追加。
- **Service**: SendGridを用いた予約確認メール送信機能の実装。

### フロントエンド
- **ページ**:
    - `TicketReservationPage`: 予約フォーム（一般公開用）。
    - `ReservationCompletedPage`: 予約完了画面（Googleカレンダー追加ボタン付き）。
    - `ReservationListPage`: プロジェクト管理者向け予約一覧・出欠管理ページ。
- **コンポーネント**:
    - `MilestoneSettings`: マイルストーン設定モーダルに「予約定員」入力フィールドと予約ページURL表示を追加。
- **ライブラリ**:
    - `SameSite`属性やCORS関連の調整（必要に応じて）。
    - `React Query` v5 構文への対応。

## 検証手順

### 1. マイルストーンへの定員設定と予約URL取得
1. プロジェクト設定 > スケジュール（またはマイルストーン設定）を開く。
2. 既存のマイルストーンを編集（または新規作成）し、「予約定員」を設定する（例: 50名）。
3. マイルストーンリストに表示される「予約ページ」リンクをコピーする。

### 2. チケット予約（一般ユーザー視点）
1. コピーした予約URL（例: `/reservations/<milestone_id>`）にアクセスする。
2. フォーム（名前、メール、枚数、紹介者）を入力し、「予約する」を押下。
3. 完了画面が表示され、「Googleカレンダーに追加」ボタンが機能することを確認。
4. 入力したメールアドレスに確認メールが届いていることを確認（SendGrid設定済みの場合）。

### 3. 管理者による確認（管理者視点）
1. プロジェクトページ > 「予約管理」タブ（またはリンク）にアクセス。
2. 先ほどの予約が表示されていることを確認。
3. 詳細を確認し、必要に応じて「出欠」ステータスを更新できることを確認。
4. 「CSVダウンロード」ボタンを押し、予約リストがダウンロードできることを確認。

## テスト実行
バックエンドのユニットテストを実行するには以下のコマンドを使用してください：
```bash
cd backend
uv run pytest tests/api/test_reservations.py
```
（現在、CI環境等での出力バッファリングにより詳細ログが見えない場合がありますが、上記手順での手動確認を推奨します。）
