# 公開脚本インポート時のプロジェクト制限バグ修正

## 問題点
`import_script` エンドポイントでは、公開脚本からプロジェクトを作成する際に **公開** プロジェクトとして作成されます。これにより、非公開プロジェクトの作成数制限（上限2つ）が適用されません。また、公開脚本から作成されたプロジェクトは **非公開** にすべき（帰属保護のため）という `create_project` のポリシーとも矛盾しています。

## 変更案

### Backend
#### [MODIFY] [projects.py](file:///f:/src/PythonProject/pscweb3-1/backend/src/api/projects.py)
`import_script` 関数内:
- `check_project_limit(..., new_project_is_public=True)` を `new_project_is_public=False` に変更します。
- `TheaterProject(..., is_public=True)` を `is_public=False` に変更します。
- `Script(..., is_public=True)` を `is_public=False` に変更します。

## ユーザーの懸念事項の検証（抜け穴について）
**懸念**: 公開脚本からプロジェクトを作成（現在Publicになる）した後、脚本を上書きして非公開に変更することで、制限を回避できないか？

**検証結果**: 回避できません。
`backend/src/services/script_processor.py` の `process_script_upload` 関数において、脚本の公開設定を変更する際に必ず `check_project_limit` が実行されます。
ここで `is_public` を `True` から `False` に変更しようとすると、その時点で非公開プロジェクト数の制限チェックが行われ、上限を超えている場合はエラー（400）が発生します。
したがって、今回の修正で入口さえ塞げば（最初は強制的に非公開で作成）、後の変更による抜け穴は既に塞がれています。

## この変更による影響（高校生向けの説明）
**Q. この修正をすると、困ることはありますか？**

**A. はい、一部のユーザーにとって「あれ？作れなくなった？」ということが起こります。**

今までこのバグのおかげで、公開されている脚本からなら、プロジェクトを何個でも作れてしまっていました。
しかし、修正後は**「非公開プロジェクト」として作られるようになるため、すでに自分のプロジェクトを2つ持っている人は、エラーが出て新しいプロジェクトを作れなくなります。**

例えるなら：
> 今までは「図書館の本を借りてくる（公開脚本の利用）」なら、手持ちのカバンがいっぱいでも特別に持ち帰れていました。
> でも本当のルールは「カバンに入るのは2冊まで（非公開プロジェクト制限）」です。
> 今回の修正で、図書館の本であっても、カバンの空きがないと持ち帰れなくなります。

**解決策**:
これ以上作りたい場合は、今持っているプロジェクトを削除するか、あるいは自分のプロジェクトを「公開」設定に変更して（カバンから出して）、枠を空ける必要があります。

## 検証計画

### 自動テスト
1. **新規テストケース**: `backend/tests/unit/test_api_projects.py` に `test_import_script_respects_limit` を追加（または新規ファイル `test_bug_fix_limit.py`）。
   - 準備: ユーザーを作成し、非公開プロジェクトを2つ作成しておく。
   - 実行: `import_script` を呼び出す。
   - 期待値: 
     - **修正前**: 成功する (HTTP 200)。
     - **修正後**: 失敗する (HTTP 400 "Limit Exceeded")。

### 手動検証
- コードレビューにて `create_project` との整合性を確認します。
