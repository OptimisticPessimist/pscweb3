# 日程調整カレンダー シーン絞り込み機能 実装計画

## 目標
以前の実装（`feature/39-calendar-schedule-view`）において、「シーンから逆引きして候補日を絞り込む機能」のバックエンドロジックは実装されていましたが、フロントエンドのカレンダー画面における「シーンで絞り込む」ドロップダウンUIが実装漏れとなっていました。
本対応では、カレンダーの表示にシーン絞り込み機能を追加し、指定したシーンの稽古が可能な日程を一目で確認できるようにします。

## 対象ファイル
- `frontend/src/features/schedule_polls/components/SchedulePollCalendar.tsx`

## 実装内容
### 1. シーン一覧の抽出
カレンダー分析結果（`analysis.analyses`）から、`possible_scenes` および `reach_scenes` に含まれるすべてのシーンを抽出し、一意なシーンのリストを作成します。この際、シーン番号順にソートします。

### 2. 状態管理とUIの追加
- `useState` を用いて `selectedSceneId`（選択中のシーンID、初期値は `null` ＝すべて）を管理します。
- カレンダー上部（凡例の横など）に、「すべてのシーン対象」と各シーンを選択できるプルダウン（`<select>`）を配置します。

### 3. 表示のフィルタリングとハイライト
`FullCalendar` に渡すイベント（`events`）の生成ロジックを変更します。
- **シーンが選択されていない場合（すべて）**:  
  現状通り、いずれかのシーンが「稽古可能」なら緑（emerald）、「リーチ」なら黄（amber）とし、それ以外はグレーとします。
- **特定シーンが選択されている場合**:
  - 選択したシーンが `possible_scenes` に含まれていれば緑色（emerald）、テキストは「🟢 稽古可能」またはシーン見出し等に変更。
  - 選択したシーンが `reach_scenes` に含まれていれば黄色（amber）、テキストは「🟡 リーチ」。
  - どちらにも含まれていない場合、カレンダー上のイベントの色をグレー（slate-200等）にし、不透明度を下げ（opacity-40等）、テキストを「⚪ 不可」に変更します。

### 4. サイドパネルの対応
カレンダーのイベントをクリックしてサイドパネルを開いた際、もし「特定シーン」で絞り込んでいるなら、そのシーンが「稽古可能」なのか「リーチ」なのか（誰が不足しているのか）を分かりやすく強調表示するか、既存のリストの中で該当シーンが見つけやすい状態にします（今回はイベント情報にそのままデータを渡せるため、既存のパネル表示でも問題ありませんが、必要に応じて「選択中のシーンの状態: リーチ(不足: 山田)」などをパネル上部に表示するのも親切です）。

## 検証計画
### 手動検証
1. 日程調整の回答がすでにあるプロジェクトの「日程調整」詳細画面を開きます（カレンダービュー）。
2. カレンダー上部に「すべてのシーン」というドロップダウンが表示されていることを確認します。
3. ドロップダウンを開き、特定のシーン（例: シーン2）を選択します。
4. カレンダー上のイベントが、そのシーンが稽古可能な日時だけ緑色/黄色にハイライトされ、それ以外が薄い灰色になることを確認します。
5. 緑色のイベントをクリックしてサイドパネルを開き、該当シーンが本当に「稽古可能シーン」に含まれていることを確認します。
6. 黄色のイベントをクリックしてサイドパネルを開き、該当シーンが「あと1人で可能なシーン（リーチ）」に含まれていることを確認します。
