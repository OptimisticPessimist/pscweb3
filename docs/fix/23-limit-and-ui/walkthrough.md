# プロジェクト制限の修正とUI改善

## 概要
プロジェクト作成数の制限（公開1、非公開1）に関する問題を修正し、ダッシュボード上で公開/非公開プロジェクトを識別できるようにしました。

## 変更点

### 1. データベーススキーマの変更
- `TheaterProject` テーブルに `is_public` (BOOL) カラムを追加しました。
- 既存のプロジェクトはデフォルトで `FALSE` (非公開) に設定されます。

### 2. バックエンドロジックの変更
- **プロジェクト制限チェック**: 
  - 以前は脚本をすべて取得して公開状態を確認していましたが、`TheaterProject.is_public` カラムを直接クエリすることで高速化・簡素化しました。
  - 公開プロジェクトは作成数制限のカウント対象外としました。
- **プロジェクト作成API**:
  - `ProjectResponse` に `is_public` を含めるようにしました。
  - 公開脚本からのインポート時、作成されるプロジェクトと脚本の両方に `is_public=True` を設定するようにしました。
- **脚本アップロード/更新**:
  - 脚本の `is_public` フラグが変更されると、親プロジェクトの `TableProject.is_public` も同期されるようにしました（1プロジェクト1脚本のため）。

### 3. フロントエンド (Dashboard) の変更
- **プロジェクト一覧**:
  - `Project` 型に `is_public` を追加しました。
  - ダッシュボードのプロジェクトカードに「公開 (Public)」バッジを表示するようにしました。
- **制限ロジック**:
  - 「新規プロジェクト作成」ボタンの活性/非活性判定において、公開プロジェクトをカウントから除外するように修正しました。

## 検証結果

### 自動テスト
- `backend/src/services/project_limit.py` のロジック変更により、DB操作が効率化されました。
- `backend/src/api/projects.py` の変更により、インポート時の公開設定が正しく適用されます。

### 手動検証手順 (ユーザー実施)
1. **ダッシュボード確認**:
   - 既存のプロジェクトが表示されているか確認。
   - 公開プロジェクトがあれば「公開」バッジがついているか確認。
2. **プロジェクト作成（制限内）**:
   - 非公開プロジェクトが2つ未満の場合、新規作成できるか確認。
3. **プロジェクト作成（制限超過）**:
   - 非公開プロジェクトを2つ作成した後、新規作成ボタンがグレーアウトし「作成できるプロジェクトは2つまでです」と表示されるか確認。
4. **公開脚本のインポート**:
   - 公開スクリプトページから「この脚本を使う」を実行。
   - 作成されたプロジェクトに「公開」バッジがつき、制限数にカウントされていないことを確認（ボタンが有効なままか）。

## 次のステップ
- 本番環境（Azure）へのデプロイ時に、自動的にマイグレーションが適用されます。
- 万が一エラーが発生した場合は、Azureのログを確認してください（カラム追加の反映待ちなど）。
